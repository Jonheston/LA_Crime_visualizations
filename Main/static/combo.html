<!DOCTYPE html>
<!-- saved from url=(0060)http://www.chartjs.org/samples/latest/scales/time/combo.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>Line Chart - Combo Time Scale</title>
	<script async="" src="./combo_files/analytics.js.download"></script><script src="./combo_files/moment.min.js.download"></script>
	<script src="./combo_files/Chart.js.download"></script><style type="text/css">/* Chart.js */
@-webkit-keyframes chartjs-render-animation{from{opacity:0.99}to{opacity:1}}@keyframes chartjs-render-animation{from{opacity:0.99}to{opacity:1}}.chartjs-render-monitor{-webkit-animation:chartjs-render-animation 0.001s;animation:chartjs-render-animation 0.001s;}</style>
	<script src="./combo_files/utils.js.download"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.13.0/d3.min.js"></script>
	<script src="http://underscorejs.org/underscore-min.js"></script>
	
	<style>
		canvas {
			-moz-user-select: none;
			-webkit-user-select: none;
			-ms-user-select: none;
		}
	</style>
</head>

<body>
	<div style="width:75%;"><div class="chartjs-size-monitor" style="position: absolute; left: 0px; top: 0px; right: 0px; bottom: 0px; overflow: hidden; pointer-events: none; visibility: hidden; z-index: -1;"><div class="chartjs-size-monitor-expand" style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1;"><div style="position:absolute;width:1000000px;height:1000000px;left:0;top:0"></div></div><div class="chartjs-size-monitor-shrink" style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1;"><div style="position:absolute;width:200%;height:200%;left:0; top:0"></div></div></div>
		<canvas id="canvas" width="752" height="376" class="chartjs-render-monitor" style="display: block; height: 301px; width: 602px;"></canvas>
	</div>
	<br>
	<br>
	<button id="randomizeData">Randomize Data</button>
	<button id="addDataset">Add Dataset</button>
	<button id="removeDataset">Remove Dataset</button>
	<button id="addData">Add Data</button>
	<button id="removeData">Remove Data</button>
	<script type="text/javascript"src="functions.js"></script>
	<script>
		var timeFormat = 'MM/DD/YYYY HH:mm';

		function newDateString(days) {
			return moment().add(days, 'd').format(timeFormat);
		}

var timeline = []

function getData() {
    d3.csv("Violent_crimes_Complete.csv", function(error, Data) {

        // Throw an error if one occurs
        if (error) throw error;

        // Print the forceData
        // console.log(forceData);

        // Format the date and cast the force value to a number
        // forceData.forEach(function(data) {
        // data.date = parseTime(data.date);
        // data.force = +data.force;
        // });
    var zipcode = 90013;
    var filteredData = Data.filter(data => data['Zip Code'] == zipcode);

    var zipfinder = d3.select("#zipfinder");

    zipfinder.on("change", function() {
      var newText = d3.event.target.value;
    zipcode = newText;
      
    var filteredData = Data.filter(data => data['Zip Code'] == zipcode);
    });
    
    // function updateGraph(){

    console.log(filteredData);
        
    // var timeline = [];

    for (i=1; i < 13; i++){
        var month_crimes = filteredData.filter(data => data.Month == i)
		var month_total = month_crimes.length
		console.log(typeof month_total)
		 timeline.push(month_total)
        // timeline.push({x:i, y:month_total})
    }

    //get unique kinds of weapons:
	var weapons = filteredData.map(data => data.weapon_desc);
	// console.log(weapons)
	var unique_weapons = _.uniq(weapons)
	console.log(unique_weapons)
	
	var weapon_months = unique_weapons.map(function(data){
		//console.log(data)
		var w_timeline = []
		for (i=1; i < 13; i++){
		var month_crimes = filteredData.filter(d => d.Month == i)

		var weapon_crimes = month_crimes.filter(d => d.weapon_desc == data)
		//console.log(weapon_crimes)
		var weapon_total = weapon_crimes.length
		w_timeline.push({x:i, y:weapon_total})
	}
	return [data, w_timeline]
	})
	
	console.log(timeline)
	console.log(weapon_months)
	// console.log(timeline);
	
});

};

function timeConverter(time){
	//time = parseInt(time, 10)
    switch (time) {
		case time < 10:
			time = time.toString()
          var newTime = `0:0${time}`
          break;
		case time < 60:
		time = time.toString()
          var newTime = `0:${time}`
          break;
		case time < 1000:
		time = time.toString()
          var newTime = `${time.substr(0,1)}:${time.substr(1,2)}`
          break;
		default:
		time = time.toString()
         var newTime = `${time.substr(0,2)}:${time.substr(2,2)}`
      } 
      return newTime

};
// console.log(timeConverter(20));
var promise = new Promise(function(resolve, reject){
	getData()});

console.log(timeline);

// promise.then(function(result){
// // var months = [1,2,3,4,5,6,7,8,9,10,11,12]
// 	console.log(result)
		var color = Chart.helpers.color;
		var config = {
			type: 'bar',
			data: {
				labels: [1, 2,3,4,5,6,7,8,9,10,11,12],
				datasets: [
				// 	type: 'bar',
				// 	label: 'Dataset 1',
				// 	backgroundColor: color(window.chartColors.red).alpha(0.5).rgbString(),
				// 	borderColor: window.chartColors.red,
				// 	data: [
				// 		randomScalingFactor(),
				// 		randomScalingFactor(),
				// 		randomScalingFactor(),
				// 		randomScalingFactor(),
				// 		randomScalingFactor(),
				// 		randomScalingFactor(),
				// 		randomScalingFactor()
				// 	],
				// }, {
				// 	type: 'bar',
				// 	label: 'Dataset 2',
				// 	backgroundColor: color(window.chartColors.blue).alpha(0.5).rgbString(),
				// 	borderColor: window.chartColors.blue,
				// 	data: [
				// 		randomScalingFactor(),
				// 		randomScalingFactor(),
				// 		randomScalingFactor(),
				// 		randomScalingFactor(),
				// 		randomScalingFactor(),
				// 		randomScalingFactor(),
				// 		randomScalingFactor()
				// 	],
				// }, 
				{
					type: 'line',
					label: 'Dataset 3',
					backgroundColor: color(window.chartColors.green).alpha(0.5).rgbString(),
					borderColor: window.chartColors.green,
					fill: false,
					labels: [1,2,3,4,5,6,7,8,9,10,11,12],
					data: timeline
				}]
			},
			options: {
				title: {
					text: 'Chart.js Combo Time Scale'
				
				 
				// scales: {
				// 	xAxes: [{
				// 		type: 'time',
				// 		display: true,
				// 	}],
				},
			}
		};
		console.log(timeline)
	
			console.log("before the chart")

		promise.then(function(result){	
			var ctx = document.getElementById('canvas').getContext('2d');
			window.myLine = new Chart(ctx, config);
			console.log("after the chart")
		});

	

		

		document.getElementById('randomizeData').addEventListener('click', function() {
			config.data.datasets.forEach(function(dataset) {
				dataset.data = dataset.data.map(function() {
					return randomScalingFactor();
				});
			});

			window.myLine.update();
		});

		var colorNames = Object.keys(window.chartColors);
		document.getElementById('addDataset').addEventListener('click', function() {
			var colorName = colorNames[config.data.datasets.length % colorNames.length];
			var newColor = window.chartColors[colorName];
			var newDataset = {
				label: 'Dataset ' + config.data.datasets.length,
				borderColor: newColor,
				backgroundColor: color(newColor).alpha(0.5).rgbString(),
				data: [],
			};

			for (var index = 0; index < config.data.labels.length; ++index) {
				newDataset.data.push(randomScalingFactor());
			}

			config.data.datasets.push(newDataset);
			window.myLine.update();
		});

		document.getElementById('addData').addEventListener('click', function() {
			if (config.data.datasets.length > 0) {
				config.data.labels.push(newDateString(config.data.labels.length));

				for (var index = 0; index < config.data.datasets.length; ++index) {
					config.data.datasets[index].data.push(randomScalingFactor());
				}

				window.myLine.update();
			}
		});

		document.getElementById('removeDataset').addEventListener('click', function() {
			config.data.datasets.splice(0, 1);
			window.myLine.update();
		});

		document.getElementById('removeData').addEventListener('click', function() {
			config.data.labels.splice(-1, 1); // remove the label first

			config.data.datasets.forEach(function(dataset, datasetIndex) {
				config.data.datasets[datasetIndex].data.pop();
			});

			window.myLine.update();
		});
	// });
	</script>



</body></html>